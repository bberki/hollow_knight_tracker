<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hollow Knight · 112% + Boss Tracker</title>
  <style>
    :root{--bg:#f6f7fb;--fg:#0f172a;--muted:#64748b;--card:#fff;--border:#e2e8f0;--accent:#111827}
    :root[data-theme="dark"]{--bg:#0b1020;--fg:#e5e7eb;--muted:#94a3b8;--card:#111827;--border:#1f2937;--accent:#2563eb}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .container{max-width:1000px;margin:0 auto;padding:24px}
    h1{margin:0 0 8px;font-size:24px} .sub{color:var(--muted);margin:0 0 16px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:var(--card);border:1px solid var(--border);padding:8px 12px;border-radius:12px;cursor:pointer;color:var(--fg)}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .input{flex:1;min-width:220px;background:var(--card);border:1px solid var(--border);padding:8px 12px;border-radius:12px;color:var(--fg)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .card-h{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
    .card-h h2{margin:0;font-size:16px} .chev{color:var(--muted)}
    .card-b{padding:8px 16px}
    .rowitem{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-top:1px solid var(--border)}
    .rowitem:first-child{border-top:0}
    label{cursor:pointer}
    .meta{color:var(--muted);font-size:12px}
    .note{width:100%;max-width:380px;border:1px solid var(--border);border-radius:10px;padding:6px 8px;background:var(--card);color:var(--fg)}
    .input::placeholder,.note::placeholder{color:var(--muted)}
    .progress{height:10px;background:var(--border);border-radius:999px;overflow:hidden}
    .bar{height:100%;background:var(--accent);width:0}
    .footer{color:var(--muted);font-size:12px;margin-top:16px}
    .badge{font-size:11px;border:1px solid var(--border);border-radius:999px;padding:2px 8px;color:var(--fg)}
    .mandatory{background:var(--accent);color:#fff;border-color:var(--accent)}
    .tabs{display:flex;gap:8px;margin:12px 0}
    .tab-btn{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:var(--card);cursor:pointer;color:var(--fg)}
    .tab-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    .hidden{display:none}
  </style>
  <!-- Style overrides for a sleeker look -->
  <style>
    :root{ --radius:14px; --radius-sm:10px; --shadow:0 1px 2px rgba(15,23,42,.06),0 6px 24px rgba(15,23,42,.06); --ring:0 0 0 3px rgba(37,99,235,.25); --accent:#2563eb }
    :root[data-theme="dark"]{ --shadow:0 1px 2px rgba(0,0,0,.35),0 8px 28px rgba(0,0,0,.35); --ring:0 0 0 3px rgba(96,165,250,.25); --accent:#60a5fa }
    body{ font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu }
    .container{ max-width:960px }
    h1{ letter-spacing:.2px }
    .btn{ border-radius:var(--radius-sm); transition:transform .08s ease, box-shadow .15s ease, background .2s ease }
    .btn:hover{ box-shadow:var(--shadow) }
    .btn:active{ transform:translateY(1px) }
    .btn:focus-visible{ outline:none; box-shadow:var(--ring) }
    .btn.primary{ border-color:transparent }
    .input{ padding:10px 12px; border-radius:var(--radius-sm); transition:box-shadow .15s ease,border-color .15s ease }
    .input:focus{ outline:none; border-color:var(--accent); box-shadow:var(--ring) }
    .note{ padding:8px 10px; border-radius:var(--radius-sm) }
    .note:focus{ outline:none; border-color:var(--accent); box-shadow:var(--ring) }
    .card{ border-radius:var(--radius); box-shadow:var(--shadow) }
    .card-h{ gap:8px }
    .card-h h2{ font-size:15px; font-weight:600 }
    .card-h:hover{ background:color-mix(in oklab, var(--card) 92%, var(--border)) }
    .card-h-left{ display:flex; align-items:center; gap:8px }
    .card-h-right{ display:flex; align-items:center; gap:8px }
    .ratio{ min-width:56px; text-align:right; color:var(--muted); font-size:12px; font-variant-numeric:tabular-nums }
    .rowitem{ padding:12px 0 }
    .badge{ background:color-mix(in oklab, var(--card) 85%, var(--border)) }
    .mandatory{ border-color:transparent }
    .tab-btn{ border-radius:var(--radius-sm); transition:box-shadow .15s ease, background .2s ease }
    .tab-btn:hover{ box-shadow:var(--shadow) }
    .tab-btn.active{ border-color:transparent }
    .bar{ background:linear-gradient(90deg,var(--accent),color-mix(in oklab,var(--accent) 80%, var(--card))); transition:width .25s ease }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hollow Knight · 112% + Boss Tracker</h1>
    <p class="sub">Check items off and it stores locally in your browser.</p>

    <div class="tabs">
      <button id="tab-boss" class="tab-btn active">Bosses</button>
      <button id="tab-112" class="tab-btn">112% Checklist</button>
      <button id="theme-toggle" class="tab-btn" style="margin-left:auto" title="Toggle theme">🌙</button>
    </div>

    <!-- BOSS VIEW -->
    <div id="view-boss">
      <div class="row" style="margin-bottom:12px">
        <input id="q" class="input" placeholder="Search: boss or area" />
        <div class="row">
          <button class="btn" data-filter="all">All</button>
          <button class="btn" data-filter="next">Next</button>
          <button class="btn" data-filter="todo">Todo</button>
          <button class="btn" data-filter="done">Done</button>
          <button class="btn" data-filter="mandatory">Mandatory</button>
          <button class="btn" data-filter="optional">Optional</button>
        </div>
      </div>

      <div class="card" style="margin-bottom:12px">
        <div class="card-b">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <div style="font-weight:600">Progress</div>
            <div id="stat" class="sub"></div>
          </div>
          <div class="progress"><div id="bar" class="bar"></div></div>
        </div>
      </div>

      <div class="row" style="margin-bottom:12px">
        <button id="reset" class="btn">Reset</button>
        <button id="mark-mandatory" class="btn">Mark Mandatory Done</button>
        <button id="export" class="btn">Export</button>
        <label class="btn" style="position:relative;overflow:hidden">
          Import <input id="import" type="file" accept="application/json" style="position:absolute;inset:0;opacity:0;cursor:pointer" />
        </label>
      </div>

      <div id="root" class="space"></div>
    </div>

    <!-- 112% VIEW -->
    <div id="view-112" class="hidden">
      <div class="row" style="margin-bottom:12px">
        <input id="q112" class="input" placeholder="Search: item or category" />
      </div>
      <div class="card" style="margin-bottom:12px">
        <div class="card-b">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <div style="font-weight:600">112% Progress</div>
            <div id="stat112" class="sub"></div>
          </div>
          <div class="progress"><div id="bar112" class="bar"></div></div>
        </div>
      </div>

      <div class="row" style="margin-bottom:12px">
        <button id="export112" class="btn">Export (112%)</button>
        <label class="btn" style="position:relative;overflow:hidden">
          Import (112%) <input id="import112" type="file" accept="application/json" style="position:absolute;inset:0;opacity:0;cursor:pointer" />
        </label>
        <button id="reset112" class="btn">Reset (112%)</button>
      </div>

      <div id="sec112"></div>
    </div>

    <div class="footer">* Stored in localStorage. You can export/import your progress anytime.</div>
  </div>

<script>
(function(){
  const STORAGE_KEY = 'hk-boss-tracker-v1-simple-en';
  const STORAGE_KEY_112 = 'hk-112-tracker-v1-en';

  // ---- Boss dataset (English/original names) ----
  const PHASE_ORDER = ['Early Game','Mid Game','Late Game','Final','Dream Bosses','Warrior Dreams'];
  const BOSSES = [
    // Early
    {id:'false-knight', name:'False Knight', area:'Forgotten Crossroads', mandatory:true, phase:'Early Game', order:1},
    {id:'gruz-mother', name:'Gruz Mother', area:'Forgotten Crossroads', mandatory:false, phase:'Early Game', order:2},
    {id:'hornet-protector', name:'Hornet (Protector)', area:'Greenpath', mandatory:true, phase:'Early Game', order:3},

    // Mid
    {id:'mantis-lords', name:'Mantis Lords', area:'Fungal Wastes / Mantis Village', mandatory:false, phase:'Mid Game', order:4},
    {id:'soul-master', name:'Soul Master', area:'City of Tears', mandatory:true, phase:'Mid Game', order:5},
    {id:'dung-defender', name:'Dung Defender', area:'Royal Waterways', mandatory:false, phase:'Mid Game', order:6},
    {id:'broken-vessel', name:'Broken Vessel', area:'Ancient Basin', mandatory:true, phase:'Mid Game', order:7},
    {id:'crystal-guardian', name:'Crystal Guardian', area:'Crystal Peak', mandatory:false, phase:'Mid Game', order:8},
    {id:'watcher-knights', name:'Watcher Knights', area:"City of Tears / Watcher's Spire", mandatory:true, phase:'Mid Game', order:9},

    // Late
    {id:'nosk', name:'Nosk', area:'Deepnest', mandatory:false, phase:'Late Game', order:10},
    {id:'hornet-sentinel', name:'Hornet (Sentinel)', area:"Kingdom's Edge", mandatory:true, phase:'Late Game', order:11},
    {id:'traitor-lord', name:'Traitor Lord', area:"Queen's Gardens", mandatory:true, phase:'Late Game', order:12},
    {id:'uumuu', name:'Uumuu', area:'Fog Canyon / Teacher’s Archive', mandatory:true, phase:'Late Game', order:13},

    // Final
    {id:'hollow-knight', name:'The Hollow Knight', area:'Temple of the Black Egg', mandatory:true, phase:'Final', order:14},
    {id:'radiance', name:'Radiance', area:'Dream / Endgame', mandatory:false, phase:'Final', order:15},

    // Dream Bosses (optional)
    {id:'failed-champion', name:'Failed Champion (Dream)', area:'Forgotten Crossroads', mandatory:false, phase:'Dream Bosses', order:16},
    {id:'soul-tyrant', name:'Soul Tyrant (Dream)', area:'City of Tears', mandatory:false, phase:'Dream Bosses', order:17},
    {id:'lost-kin', name:'Lost Kin (Dream)', area:'Ancient Basin', mandatory:false, phase:'Dream Bosses', order:18},
    {id:'white-defender', name:'White Defender (Dream)', area:'Royal Waterways', mandatory:false, phase:'Dream Bosses', order:19},
    {id:'nkg', name:'Nightmare King Grimm', area:'Grimm Troupe', mandatory:false, phase:'Dream Bosses', order:20},
    {id:'grey-prince-zote', name:'Grey Prince Zote', area:"Dirtmouth (Bretta's House)", mandatory:false, phase:'Dream Bosses', order:21},

    // Warrior Dreams (optional)
    {id:'elder-hu', name:'Elder Hu', area:'Fungal Wastes', mandatory:false, phase:'Warrior Dreams', order:22},
    {id:'xero', name:'Xero', area:'Resting Grounds', mandatory:false, phase:'Warrior Dreams', order:23},
    {id:'gorb', name:'Gorb', area:'Howling Cliffs', mandatory:false, phase:'Warrior Dreams', order:24},
    {id:'no-eyes', name:'No Eyes', area:'Greenpath (Stone Sanctuary)', mandatory:false, phase:'Warrior Dreams', order:25},
    {id:'marmu', name:'Marmu', area:"Queen's Gardens", mandatory:false, phase:'Warrior Dreams', order:26},
    {id:'galien', name:'Galien', area:'Deepnest', mandatory:false, phase:'Warrior Dreams', order:27},
    {id:'markoth', name:'Markoth', area:"Kingdom's Edge", mandatory:false, phase:'Warrior Dreams', order:28},
  ];

  // ---- Boss state & UI ----
  let state = load();
  const els = {
    root: document.getElementById('root'),
    q: document.getElementById('q'),
    stat: document.getElementById('stat'),
    bar: document.getElementById('bar'),
    reset: document.getElementById('reset'),
    markMandatory: document.getElementById('mark-mandatory'),
    exportBtn: document.getElementById('export'),
    importInput: document.getElementById('import'),
  };

  function load(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {done:{}, notes:{}, filter:'next'} }catch{ return {done:{}, notes:{}, filter:'next'} } }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

  function nextBossId(){ const sorted=[...BOSSES].sort((a,b)=>a.order-b.order); const n=sorted.find(b=>!state.done[b.id]); return n && n.id; }

  function renderBosses(){
    const q = els.q.value.trim().toLowerCase();
    const filter = state.filter || 'next';
    let list = BOSSES.filter(b=>{ if(!q) return true; return b.name.toLowerCase().includes(q) || b.area.toLowerCase().includes(q); });
    const next = nextBossId();
    list = list.filter(b=>{ const isDone=!!state.done[b.id]; switch(filter){ case 'all': return true; case 'next': return b.id===next || (!isDone && !next); case 'todo': return !isDone; case 'done': return isDone; case 'mandatory': return b.mandatory; case 'optional': return !b.mandatory; default: return true; } });

    const groups = {}; list.forEach(b=>{ (groups[b.phase] ||= []).push(b); }); for(const k in groups){ groups[k].sort((a,b)=>a.order-b.order); }

    const total=BOSSES.length; const done=BOSSES.filter(b=>state.done[b.id]).length; const pct=Math.round(done/total*100); els.stat.textContent=`${done}/${total} · ${pct}%`; els.bar.style.width=pct+'%';

    els.root.innerHTML='';
    PHASE_ORDER.filter(p=>groups[p]?.length).forEach(phase=>{
      const sec = h('div',{class:'card',style:'margin-bottom:12px'});
      const head = h('div',{class:'card-h'});
      const left = h('div',{class:'card-h-left'});
      const right = h('div',{class:'card-h-right'});
      const doneInGroup = (groups[phase].filter(b=>state.done[b.id]).length)||0;
      const totalInGroup = groups[phase].length;
      left.appendChild(h('h2',{}, phase));
      right.appendChild(h('div',{class:'ratio'}, `${doneInGroup}/${totalInGroup}`));
      head.appendChild(left);
      head.appendChild(right);
      sec.appendChild(head);

      const body = h('div',{class:'card-b'});
      groups[phase].forEach(b=>{
        const row = h('div',{class:'rowitem'});
        const cb = h('input',{type:'checkbox'});
        cb.checked = !!state.done[b.id];
        cb.addEventListener('change',()=>{ state.done[b.id]=cb.checked; save(); renderBosses(); });

        const info = h('label',{});
        const title = h('div',{}, b.name + (b.mandatory?' *':''));
        const meta = h('div',{class:'meta'}, b.area + ' ');
        meta.appendChild(h('span',{class:'badge '+(b.mandatory?'mandatory':'')}, b.mandatory?'Mandatory':'Optional'));
        info.appendChild(title); info.appendChild(meta);

        const note = h('input',{class:'note',placeholder:'Add a note (charms, route, difficulty…)'});
        note.value = state.notes?.[b.id] || '';
        note.addEventListener('input',()=>{ state.notes[b.id]=note.value; save(); });

        row.appendChild(cb); row.appendChild(info); row.appendChild(note);
        body.appendChild(row);
      });

      sec.appendChild(body); els.root.appendChild(sec);
    });
  }

  // Controls
  els.q.addEventListener('input', renderBosses);
  document.querySelectorAll('[data-filter]').forEach(btn=>{ btn.addEventListener('click',()=>{ state.filter = btn.dataset.filter; renderBosses(); }); });
  els.reset.addEventListener('click', ()=>{ if(confirm('Clear all boss progress?')){ state = {done:{}, notes:{}, filter:'next'}; save(); renderBosses(); }});
  els.markMandatory.addEventListener('click', ()=>{ BOSSES.filter(b=>b.mandatory).forEach(b=>state.done[b.id]=true); save(); renderBosses(); });
  els.exportBtn.addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='hollow-knight-boss-progress.json'; a.click(); URL.revokeObjectURL(url); });
  els.importInput.addEventListener('change', (e)=>{ const f=e.target.files&&e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ const p=JSON.parse(String(r.result)); state={done:p.done||{}, notes:p.notes||{}, filter:state.filter||'next'}; save(); renderBosses(); }catch{ alert('Invalid file'); } }; r.readAsText(f); });

  // ---- 112% DATA (original English names) ----
  const DATA112 = [
    { cat:'Dream Nail', items:[
      {id:'dn-acquire', label:'Dream Nail (acquire)'},
      {id:'dn-awoken', label:'Awoken Dream Nail (1800 Essence)'},
      {id:'dn-seer2400', label:'Seer final dialogue (2400 Essence)'}
    ]},
    { cat:'Dreamers', items:[
      {id:'dr-monomon', label:'Monomon the Teacher'},
      {id:'dr-lurien', label:'Lurien the Watcher'},
      {id:'dr-herrah', label:'Herrah the Beast'}
    ]},
    { cat:'Nail Upgrades', items:[
      {id:'nail-sharpened', label:'Sharpened Nail'},
      {id:'nail-channelled', label:'Channelled Nail'},
      {id:'nail-coiled', label:'Coiled Nail'},
      {id:'nail-pure', label:'Pure Nail'}
    ]},
    { cat:'Nail Arts', items:[
      {id:'art-great-slash', label:'Great Slash'},
      {id:'art-dash-slash', label:'Dash Slash'},
      {id:'art-cyclone', label:'Cyclone Slash'}
    ]},
    { cat:'Spells & Upgrades', items:[
      {id:'sp-vengeful', label:'Vengeful Spirit'},
      {id:'sp-shade-soul', label:'Shade Soul (upgrade)'},
      {id:'sp-dive', label:'Desolate Dive'},
      {id:'sp-descend', label:'Descending Dark (upgrade)'},
      {id:'sp-wraiths', label:'Howling Wraiths'},
      {id:'sp-abyss-shriek', label:'Abyss Shriek (upgrade)'}
    ]},
    { cat:'Mask Shards (16)', items:[
      {id:'ms-sly150', label:'Sly (150 Geo)'},
      {id:'ms-sly500', label:'Sly (500 Geo)'},
      {id:'ms-sly800', label:'Sly (800 Geo)'},
      {id:'ms-sly1500', label:'Sly (1500 Geo)'},
      {id:'ms-brooding-mawlek', label:'Brooding Mawlek reward'},
      {id:'ms-grub-5', label:'Grubfather (5 grubs)'},
      {id:'ms-crossroads-goams', label:'Crossroads – Goam room'},
      {id:'ms-queens-station', label:"Queen's Station – east"},
      {id:'ms-bretta', label:"Bretta's house"},
      {id:'ms-stone-sanctuary', label:'Greenpath – Stone Sanctuary'},
      {id:'ms-waterways-nw', label:'Royal Waterways – northwest (acid)'},
      {id:'ms-fungal-core', label:'Fungal Core path'},
      {id:'ms-enraged-guardian', label:'Enraged Guardian reward'},
      {id:'ms-hive', label:'The Hive secret wall'},
      {id:'ms-seer1500', label:'Seer (1500 Essence)'},
      {id:'ms-grey-mourner', label:'Grey Mourner – Delicate Flower'}
    ]},
    { cat:'Vessel Fragments (9)', items: Array.from({length:9},(_,i)=>({id:`vf-${i+1}`, label:`Vessel Fragment #${i+1}`})) },
    { cat:'Stag Stations (11)', items:[
      {id:'stag-dirtmouth', label:'Dirtmouth'},
      {id:'stag-crossroads', label:'Forgotten Crossroads'},
      {id:'stag-greenpath', label:'Greenpath'},
      {id:'stag-queens-station', label:"Queen's Station"},
      {id:'stag-storerooms', label:'City Storerooms'},
      {id:'stag-kings-station', label:"King's Station"},
      {id:'stag-resting', label:'Resting Grounds'},
      {id:'stag-distant', label:'Distant Village'},
      {id:'stag-ancient-basin', label:'Ancient Basin'},
      {id:'stag-deepnest', label:'Deepnest Connection'},
      {id:'stag-nest', label:'Stag Nest (secret)'}
    ]},
    { cat:'Colosseum of Fools', items:[
      {id:'col-trial1', label:'Trial of the Warrior'},
      {id:'col-trial2', label:'Trial of the Conqueror'},
      {id:'col-trial3', label:'Trial of the Fool'}
    ]},
    { cat:'Grimm Troupe', items:[
      {id:'grimm-summon', label:'Summon the Troupe'},
      {id:'grimm-tmg', label:'Troupe Master Grimm'},
      {id:'grimm-path', label:'Choose: Banish or Nightmare King Grimm'}
    ]},
    { cat:'Godhome (for 112% — first 4 Pantheons)', items:[
      {id:'gh-p1', label:'Pantheon 1'},
      {id:'gh-p2', label:'Pantheon 2'},
      {id:'gh-p3', label:'Pantheon 3'},
      {id:'gh-p4', label:'Pantheon 4'}
    ]},
    { cat:'Warrior Dreams (7)', items:[
      {id:'wd-gorb', label:'Gorb'},
      {id:'wd-no-eyes', label:'No Eyes'},
      {id:'wd-elder-hu', label:'Elder Hu'},
      {id:'wd-xero', label:'Xero'},
      {id:'wd-galien', label:'Galien'},
      {id:'wd-marmu', label:'Marmu'},
      {id:'wd-markoth', label:'Markoth'}
    ]},
    { cat:'Whispering Roots (15)', items:[
      {id:'wr-ancestral', label:'Ancestral Mound'},
      {id:'wr-city', label:'City of Tears'},
      {id:'wr-crystal', label:'Crystal Peak'},
      {id:'wr-deepnest', label:'Deepnest'},
      {id:'wr-forgotten', label:'Forgotten Crossroads'},
      {id:'wr-fungal1', label:'Fungal Wastes (Leg Eater)'},
      {id:'wr-fungal2', label:'Fungal Wastes (Mantis Village)'},
      {id:'wr-greenpath', label:'Greenpath'},
      {id:'wr-hive', label:'The Hive'},
      {id:'wr-queens-gardens', label:"Queen's Gardens"},
      {id:'wr-resting', label:'Resting Grounds'},
      {id:'wr-howling', label:'Howling Cliffs'},
      {id:'wr-kingdoms-edge', label:"Kingdom's Edge"},
      {id:'wr-waterways', label:'Royal Waterways'},
      {id:'wr-ancient-basin', label:'Ancient Basin'}
    ]},
    { cat:'Grubs (46)', items: Array.from({length:46},(_,i)=>({id:`grub-${i+1}`, label:`Grub #${i+1}`})) },
    { cat:'Charms (45)', items:[
      'Wayward Compass','Gathering Swarm','Stalwart Shell','Soul Catcher','Shaman Stone','Soul Eater','Dashmaster','Sprintmaster','Grubsong','Grubberfly\'s Elegy','Fragile Heart','Fragile Greed','Fragile Strength','Unbreakable Heart','Unbreakable Greed','Unbreakable Strength','Spell Twister','Steady Body','Heavy Blow','Quick Slash','Longnail','Mark of Pride','Baldur Shell','Thorns of Agony','Fury of the Fallen','Quick Focus','Deep Focus','Lifeblood Heart','Lifeblood Core','Joni\'s Blessing','Hiveblood','Spore Shroom','Sharp Shadow','Shape of Unn','Nailmaster\'s Glory','Dream Wielder','Dreamshield','Glowing Womb','Defender\'s Crest','Flukenest','Weaversong','Grimmchild','Carefree Melody','Kingsoul','Void Heart'
    ].map((name,idx)=>({id:`ch-${idx+1}`, label:name})) }
  ];

  // ---- 112% state & UI ----
  let state112 = load112();
  const el112 = {
    sec: document.getElementById('sec112'),
    stat: document.getElementById('stat112'),
    bar: document.getElementById('bar112'),
    q: document.getElementById('q112'),
    exportBtn: document.getElementById('export112'),
    importInput: document.getElementById('import112'),
    reset: document.getElementById('reset112')
  };
  function load112(){
    try{
      const parsed = JSON.parse(localStorage.getItem(STORAGE_KEY_112)) || {done:{}};
      return { done: parsed.done || {}, fold: parsed.fold || {} };
    }catch{ return {done:{}, fold:{}} }
  }
  function save112(){ localStorage.setItem(STORAGE_KEY_112, JSON.stringify(state112)); }

  function render112(){
    const root = el112.sec; root.innerHTML='';
    let total=0, done=0; DATA112.forEach(g=>{ total+=g.items.length; done+=g.items.filter(it=>state112.done[it.id]).length; });
    const pct = Math.round(done/total*100); el112.stat.textContent = `${done}/${total} · ${pct}%`; el112.bar.style.width = pct+'%';
    DATA112.forEach(group=>{
      const sec = h('div',{class:'card',style:'margin-bottom:12px'});
      const head = h('div',{class:'card-h'});
      const left = h('div',{class:'card-h-left'});
      const right = h('div',{class:'card-h-right'});
      const doneInGroup = group.items.filter(it=>state112.done[it.id]).length;
      left.appendChild(h('h2',{}, group.cat));
      right.appendChild(h('div',{class:'ratio'}, `${doneInGroup}/${group.items.length}`));
      head.appendChild(left);
      head.appendChild(right);
      sec.appendChild(head);
      const body = h('div',{class:'card-b'});
      group.items.forEach(item=>{ const row=h('div',{class:'rowitem'}); const cb=h('input',{type:'checkbox'}); cb.checked=!!state112.done[item.id]; cb.addEventListener('change',()=>{ state112.done[item.id]=cb.checked; save112(); render112(); }); const label=h('label',{}, item.label); row.appendChild(cb); row.appendChild(label); body.appendChild(row); });
      sec.appendChild(body); root.appendChild(sec);
    });
  }

  // Smooth collapse/expand for 112% sections
  function setCollapsed(el, collapsed, animate){
    if(!el) return;
    el.dataset.collapsed = collapsed ? '1' : '0';
    el.style.overflow = 'hidden';
    const setNoAnim = ()=>{
      if(collapsed){ el.style.height='0px'; el.style.opacity='0'; }
      else { el.style.height=''; el.style.opacity='1'; }
    };
    if(!animate){ setNoAnim(); return; }

    // Ensure styles are initialized
    const end = ()=>{ el.style.overflow=''; el.style.transition=''; if(!collapsed){ el.style.height=''; } };
    if(collapsed){
      // slide up
      el.style.height = el.scrollHeight + 'px';
      void el.offsetHeight; // reflow
      el.style.transition = 'height .25s ease, opacity .2s ease';
      el.style.height = '0px';
      el.style.opacity = '0';
      el.addEventListener('transitionend', function handler(){ el.removeEventListener('transitionend', handler); end(); }, {once:true});
    } else {
      // slide down
      el.style.height = 'auto';
      const full = el.scrollHeight;
      el.style.height = '0px'; el.style.opacity='0';
      void el.offsetHeight; // reflow
      el.style.transition = 'height .25s ease, opacity .2s ease';
      el.style.height = full + 'px';
      el.style.opacity = '1';
      el.addEventListener('transitionend', function handler(){ el.removeEventListener('transitionend', handler); end(); }, {once:true});
    }
  }

  // 112%: collapse + search + export/import/reset
  function update112UI(){
    const q = (el112.q && el112.q.value || '').trim().toLowerCase();
    const cards = el112.sec ? Array.from(el112.sec.querySelectorAll(':scope > .card')) : [];
    cards.forEach(card=>{
      const head = card.querySelector('.card-h');
      const body = card.querySelector('.card-b');
      if(!head || !body) return;
      const cat = (head.querySelector('h2')?.textContent || '').trim();

      // Apply fold state when no active search
      const folded = q ? false : !!(state112.fold && state112.fold[cat]);
      setCollapsed(body, folded, false);

      // Ensure chevron exists and reflects state
      // Ensure right container exists
      let headRight = head.querySelector('.card-h-right');
      if(!headRight){ headRight = document.createElement('div'); headRight.className='card-h-right'; head.appendChild(headRight); }

      let chev = headRight.querySelector('.chev');
      if(!chev){
        chev = document.createElement('div');
        chev.className = 'chev';
        head.style.cursor = 'pointer';
        headRight.appendChild(chev);
      }
      chev.textContent = (body.dataset.collapsed==='1') ? '▸' : '▾';

      // Click to toggle collapse (persist)
      if(!head._collapseBound){
        head.addEventListener('click',()=>{
          const nowHidden = !(body.dataset.collapsed==='1');
          setCollapsed(body, nowHidden, true);
          chev.textContent = nowHidden ? '▸' : '▾';
          state112.fold = state112.fold || {};
          state112.fold[cat] = nowHidden;
          save112();
        });
        head._collapseBound = true;
      }

      // Search filter
      let visibleRows = 0;
      const catMatch = cat.toLowerCase().includes(q);
      card.querySelectorAll('.rowitem').forEach(row=>{
        const label = row.querySelector('label')?.textContent.toLowerCase() || '';
        const match = !q || catMatch || label.includes(q);
        row.style.display = match ? '' : 'none';
        if(match) visibleRows++;
      });
      // When searching, force body open and hide card if nothing matches
      if(q){
        setCollapsed(body, false, false);
        card.style.display = (visibleRows>0 || catMatch) ? '' : 'none';
      } else {
        card.style.display = '';
      }
    });
  }

  // Hook up 112% search and actions
  el112.q && el112.q.addEventListener('input', ()=>{ render112(); update112UI(); });
  // Auto-apply UI updates after each render via MutationObserver
  if (el112.sec && 'MutationObserver' in window){
    const obs = new MutationObserver(()=>{ update112UI(); });
    try{ obs.observe(el112.sec, {childList:true}); }catch{}
  }
  el112.exportBtn && el112.exportBtn.addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state112,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='hollow-knight-112-progress.json'; a.click();
    URL.revokeObjectURL(url);
  });
  el112.importInput && el112.importInput.addEventListener('change',(e)=>{
    const f=e.target.files&&e.target.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=()=>{ try{
      const p=JSON.parse(String(r.result));
      state112 = { done: p.done||{}, fold: p.fold||{} };
      save112(); render112(); update112UI();
    }catch{ alert('Invalid file'); } };
    r.readAsText(f);
  });
  el112.reset && el112.reset.addEventListener('click',()=>{
    if(confirm('Clear all 112% progress?')){ state112 = {done:{}, fold:{}}; save112(); render112(); update112UI(); }
  });

  // Theme
  const THEME_KEY = 'hk-theme';
  const themeToggle = document.getElementById('theme-toggle');
  function getPreferredTheme(){
    const stored = localStorage.getItem(THEME_KEY);
    if(stored==="light"||stored==="dark") return stored;
    return (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light';
  }
  function applyTheme(t){
    document.documentElement.setAttribute('data-theme', t);
    if(themeToggle){ themeToggle.textContent = (t==='dark' ? '☀️' : '🌙'); }
  }
  function setTheme(t){ localStorage.setItem(THEME_KEY, t); applyTheme(t); }
  function updateThemeToggleLabel(){ if(!themeToggle) return; const t=document.documentElement.getAttribute('data-theme'); themeToggle.textContent = (t==='dark' ? '☀' : '☾'); }
  applyTheme(getPreferredTheme());
  updateThemeToggleLabel();
  themeToggle && themeToggle.addEventListener('click',()=>{
    const next = (document.documentElement.getAttribute('data-theme')==='dark') ? 'light' : 'dark';
    setTheme(next);
    updateThemeToggleLabel();
  });

  // Tabs
  const tabBoss = document.getElementById('tab-boss');
  const tab112 = document.getElementById('tab-112');
  const viewBoss = document.getElementById('view-boss');
  const view112 = document.getElementById('view-112');
  tabBoss.addEventListener('click',()=>{ tabBoss.classList.add('active'); tab112.classList.remove('active'); viewBoss.classList.remove('hidden'); view112.classList.add('hidden'); });
  tab112.addEventListener('click',()=>{ tab112.classList.add('active'); tabBoss.classList.remove('active'); view112.classList.remove('hidden'); viewBoss.classList.add('hidden'); });

  function h(tag, attrs={}, text){ const el=document.createElement(tag); for(const k in attrs){ if(attrs[k]!==undefined) el.setAttribute(k, attrs[k]); } if(text!==undefined) el.textContent=text; return el; }

  // initial renders
  renderBosses();
  render112();
  update112UI();
  // Fix title/h1 possible mojibake and ensure consistent branding
  try{ document.title = 'Hollow Knight 112% + Boss Tracker'; }catch{}
  try{ const h=document.querySelector('h1'); if(h) h.textContent='Hollow Knight 112% + Boss Tracker'; }catch{}
})();
</script>
</body>
</html>
